/*!
 * jquery.flickEndless  v1.0.3 2013/04/11
 *
 * Copyright (c) 2013 N.Uehara
 * Dual licensed under the MIT and GPL licenses.
 * http://pochi-tools.com
 *
 */
(function(d){var c,a=window.document,b=0;d.extend(d.easing,{flickEndless_easing:function(f,g,e,i,h){return -i*(g/=h)*(g-2)+e}});d.fn.flickEndless=c=function(f){if(typeof f==="string"){var e=Array.prototype.slice.call(arguments,1),g=this;this.each(function(){var h=d.data(this,"flickEndless"),i=h&&d.isFunction(h[f])?h[f].apply(h,e):h;if(i!==h&&i!==undefined){g=i;return false}});return g}else{return this.each(function(){var h=d.data(this,"flickEndless");if(h){d.extend(true,h.options,f);h.init()}else{d.data(this,"flickEndless",new c.prototype.create(f,this))}})}};c.prototype={options:{disabled:false,vertical:false,useCssTansform:true,handle:null,clickable:null,distance:3,ratio:5,hSize:null,vSize:null,forceTranslate3d:true,endless:true,increment:1,turn:null,duration:300,onClick:null,onPageChange:null},invalidDemand:false,prefix:"ui-flickendless",isTouchDevice:("ontouchend" in a),create:function(f,h){if(h==window||h==a||/^(html|body)$/i.test(h.nodeName)){this.invalidDemand=true;return this}b++;this.options=d.extend({},this.options,f||{});this.element=h;this.$this=d(h);this.$handle=null;this.cmdTranslateBefore="translate(";this.cmdTranslateAfter=")";this.namespace="."+this.prefix+"_"+b;this.trannamespace=this.namespace+"_transition";this.position=this.$this.css("position");this.cloneClass=this.prefix+"_clone",this.$handle=d((this.options.handle)?this.$this.find(this.options.handle).first():this.$this.children().first());this.$originChild=this.$handle.children();var i=this.$this,j=this.$handle;this.orignThisStyle=i.attr("style");this.orignHandlesStyle=j.attr("style");function e(n){var k=["-webkit-","-moz-","-o-","-ms-",""];var l=d("<div />");for(var m=0;m<k.length;m++){if(typeof l.css(k[m]+n)==="string"){return k[m]+n}}return null}function g(){return("WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix())}this.transform=e("transform");this.transition=e("transition");d.support.transform=(this.transform==null)?false:true;d.support.transition=(this.transition==null)?false:true;d.support.transform3d=(g())?true:false;this.init()},init:function(){if(this.invalidDemand){return this}this.$handle.attr("style",this.orignHandleStyle);this.base={x:0,y:0};this.current={x:0,y:0};this.viewCount={x:0,y:0};this.pageSize={x:0,y:0};this.contentSize={x:0,y:0};this.contentsCount={x:0,y:0};this.contentSizeExpanded={x:0,y:0};this.movement={x:0,y:0};this.difference=0;this.page=0;this.lastPage=0;this.prevPage=1;this.isAminationRunning=false;var l=this.$this,e=this.$handle,n=this.viewCount,t=this.pageSize,j=this.contentSize,o=this.contentsCount,k=this.contentSizeExpanded,h=this.options,v=this.cloneClass,x={x:0,y:0},f={x:0,y:0};this.clean();this.$originChild=e.children();if(this.$originChild.length<1){return this}var g=this.$originChild;t.x=(h.hSize)?this.toInt(h.hSize):g.eq(0).outerWidth();t.y=(h.vSize)?this.toInt(h.vSize):g.eq(0).outerHeight();n.x=(t.x==0)?0:Math.ceil(l.width()/t.x);n.y=(t.y==0)?0:Math.ceil(l.height()/t.y);var m=g.eq(0).position();g.each(function(z){var y=g.eq(z).position();if(m.top==y.top){o.x++;j.x+=d(this).outerWidth()}if(m.left==y.left){o.y++;j.y+=d(this).outerHeight()}});x.x=-(j.x-(t.x*n.x));x.y=-(j.y-(t.y*n.y));f.x=o.x-n.x;f.y=o.y-n.y;this.lastPage=(h.vertical)?o.y:o.x;this.notEndlessLastPage=(h.vertical)?f.y:f.x;this.difference=(h.endless)?h.increment*this.lastPage:0;var p=(h.turn)?this.toInt(h.turn):Math.ceil((h.increment*this.lastPage)/2);this.turnMin=p;this.turnMax=(this.lastPage*(h.increment*2+1))-p;if(h.endless){var u=h.increment*2;if(!h.vertical){var q=j.x*(u+1);k.x=-(q-(t.x*n.x));k.y=-j.y;e.width(q)}else{k.x=-j.x;k.y=-(j.y*(u+1)-(t.y*n.y))}for(var s=0;s<u;s++){g.each(function(){d(this).clone().removeAttr("id").addClass(v).data("origin",this).appendTo(e)})}}else{k.x=x.x;k.y=x.y}if(!d.support.transform||!d.support.transition){if(h.useCssTansform){this.setOption("useCssTansform",false)}}if(!d.support.transform3d){if(h.forceTranslate3d){this.setOption("forceTranslate3d",false)}}this.cmdTranslateBefore=(h.forceTranslate3d)?"translate3d(":"translate(";this.cmdTranslateAfter=(h.forceTranslate3d)?",0)":")";l.css({overflow:"hidden"});e.css({position:/(absolute|fixed)/.test(this.position)?this.position:"relative"});var r=e.position();this.current=(!h.useCssTansform&&/(absolute|fixed)/.test(this.position))?{x:r.left,y:r.top}:{x:0,y:0};this.base.x=r.left;this.base.y=r.top;if(!h.disabled){this.enable()}this.silentGoto(this.prevPage);if(d.isFunction(h.onPageChange)){var w={target:g,page:1,count:this.lastPage};setTimeout(function(){h.onPageChange.call(w)},0)}return this},enable:function(){if(this.invalidDemand){return this}var q=this,e=this.$handle,h=this.namespace,g=this.movement,n=this.current,r=this.options,l={x:0,y:0},f=this.transform,j=false,i=false,o=this.cmdTranslateBefore,k=this.cmdTranslateAfter;var p=this.$this;if(d.isFunction(r.onClick)){if(r.clickable){e.find(r.clickable).each(function(){d(this).bind("touchend"+h+" mouseup"+h,function(s){if(j){p.unbind(h);j=i=false;s.preventDefault();s.stopImmediatePropagation();var t=this;setTimeout(function(){r.onClick.call(t)},0)}})})}else{e.children().each(function(){d(this).bind("touchend"+h+" mouseup"+h,function(s){if(j){p.unbind(h);j=i=false;s.preventDefault();s.stopImmediatePropagation();var t=d(this).data("origin")||this;setTimeout(function(){r.onClick.call(t)},0)}})})}}e.bind("touchstart"+h+" mousedown"+h,function(s){j=i=false;p.unbind(h);if(s.type==="touchstart"&&s.originalEvent.touches.length>1){return}if(s.type==="mousedown"&&s.which!=1){return}s.preventDefault();j=true;var t=s.type==="touchstart"?s.originalEvent.changedTouches[0]:s;g.x=g.y=0;l.x=t.pageX;l.y=t.pageY;q.cancelAnimation();m()});function m(){p.bind("touchmove"+h+" mousemove"+h,function(s){if(s.type==="touchmove"&&s.originalEvent.touches.length>1){p.unbind(h);j=i=false;return}var t=s.type==="touchmove"?s.originalEvent.changedTouches[0]:s;if(j){s.preventDefault();if(r.distance>1){if(Math.abs(l.x-t.pageX)<r.distance&&Math.abs(l.y-t.pageY)<r.distance){return}}e.trigger("scrollStart",q);j=false;i=true}if(i){s.preventDefault();g.x=t.pageX-l.x;g.y=t.pageY-l.y;if(r.vertical){n.y+=g.y}else{n.x+=g.x}l.x=t.pageX;l.y=t.pageY;if(r.useCssTansform){e.css(f,o+n.x+"px, "+n.y+"px"+k)}else{e.css({left:n.x,top:n.y})}}}).bind("touchend"+h+" mouseup"+h+" mouseleave"+h,function(s){p.unbind(h);if(i){q.scrollover(g.x,g.y,function(){e.trigger("scrollEnd",q)})}j=i=false})}d(window).one("unload",function(s){q.destroy()});return this},disable:function(){if(this.invalidDemand){return this}this.clean();if(this.isAminationRunning){if(this.options.useCssTansform){this.$handle.unbind(this.trannamespace).css(this.transition,"none")}else{this.$handle.stop(true,false)}this.isAminationRunning=false}return this},clean:function(){var g=this.$this,e=this.options,h=this.$handle,f=this.namespace;d(window).unbind(f);g.unbind(f);if(d.isFunction(e.onClick)){if(e.clickable){h.find(e.clickable).each(function(){d(this).unbind(f)})}else{h.children().each(function(){d(this).unbind(f)})}}this.$handle.find("."+this.cloneClass).each(function(){d(this).removeData("origin").remove()});return this},locate:function(f,g){var e=this;this.internalLocate(f,true,function(){setTimeout(function(){if(d.isFunction(g)){g.call(e)}},0)})},internalLocate:function(l,h,n){var o=this,e=this.$handle,p=this.options,j=this.current,f=this.transform,k=this.transition,m=this.cmdTranslateBefore,i=this.cmdTranslateAfter;var g=this.coordinateTransformation(l,h);this.isAminationRunning=true;e.trigger("scrollStart",o);if(p.useCssTansform){e.css(k+"-property",f).css(k+"-duration",p.duration+"ms").css(k+"-timing-function","ease").css(f,m+g.x+"px, "+g.y+"px"+i);this.transitionEndHandler(function(){o.isAminationRunning=false;o.page=g.page;j.x=g.x;j.y=g.y;e.trigger("scrollEnd",o);o.checkChangeEvents();if(d.isFunction(n)){n.call(o)}})}else{e.stop(true,false).animate({left:g.x,top:g.y},p.duration,null,function(){o.isAminationRunning=false;o.page=g.page;j.x=g.x;j.y=g.y;e.trigger("scrollEnd",o);o.checkChangeEvents();if(d.isFunction(n)){n.call(o)}})}return this},next:function(h,j){var f=this,g=(h||1);if(g<1||g>this.lastPage){setTimeout(function(){if(d.isFunction(j)){j.call(f)}},0);return this}var e=this.page+g;if(this.options.endless){var i=this.pageInfo(this.current.x,this.current.y);if(e>this.lastPage){e=1}this.internalLocate((i.physical+g),false,function(){f.silentGoto(e);setTimeout(function(){if(d.isFunction(j)){j.call(f)}},0)})}else{if(this.page>this.notEndlessLastPage){return this}this.internalLocate(e,true,function(){setTimeout(function(){if(d.isFunction(j)){j.call(f)}},0)})}return this},prev:function(h,j){var f=this,g=(h||1);if(g<1||g>this.lastPage){setTimeout(function(){if(d.isFunction(j)){j.call(f)}},0);return this}var e=this.page-g;if(this.options.endless){var i=this.pageInfo(this.current.x,this.current.y);if(e<1){e+=this.lastPage}this.internalLocate((i.physical-g),false,function(){f.silentGoto(e);setTimeout(function(){if(d.isFunction(j)){j.call(f)}},0)})}else{if(this.page<2){return this}this.internalLocate(e,true,function(){setTimeout(function(){if(d.isFunction(j)){j.call(f)}},0)})}return this},coordinateTransformation:function(i,g){var m=this.options,h=this.current,j=this.pageSize;var f=i%this.lastPage;if(f==0){f=this.lastPage}if(!m.endless&&f>this.notEndlessLastPage){f=this.notEndlessLastPage+1}var e=(!g||!m.endless)?i-1:f+this.difference-1;var k=(m.vertical)?-(e*j.y):h.y;var l=(m.vertical)?h.x:-(e*j.x);return{page:f,x:l,y:k}},pageInfo:function(f,k,j){var g=this.pageSize,h=this.contentsCount;var i=(Math.round((-k)/g.y)*h.x)+Math.round((-f)/g.x)+1;var e=i%this.lastPage;if(e==0){e=this.lastPage}return{physical:i,logical:e}},moveTo:function(p,o,m,f,q){var r=this,g=this.$handle,s=this.options,j=this.current,e=this.contentSizeExpanded,h=this.transform,l=this.transition,n=this.cmdTranslateBefore,i=this.cmdTranslateAfter;if(!s.endless){if(s.vertical){if(o>0){o=0}else{if(o<e.y){o=e.y}}}else{if(p>0){p=0}else{if(p<e.x){p=e.x}}}}var k=this.pageInfo(p,o);this.isAminationRunning=true;if(s.useCssTansform){g.css(l+"-property",h).css(l+"-duration",s.duration+"ms").css(l+"-timing-function",f).css(h,n+p+"px, "+o+"px"+i);this.transitionEndHandler(function(){r.isAminationRunning=false;r.page=k.logical;j.x=p;j.y=o;if(s.endless){if(k.physical<r.turnMin||k.physical>r.turnMax){r.silentGoto(k.logical)}}r.checkChangeEvents();if(d.isFunction(q)){q.call(r)}})}else{g.stop(true,false).animate({left:p,top:o},s.duration,m,function(){r.isAminationRunning=false;r.page=k.logical;j.x=p;j.y=o;if(s.endless){if(k.physical<r.turnMin||k.physical>r.turnMax){r.silentGoto(k.logical)}}r.checkChangeEvents();if(d.isFunction(q)){q.call(r)}})}return this},silentGoto:function(j){var e=this.$handle,m=this.options,i=this.current,f=this.transform,k=this.transition,l=this.cmdTranslateBefore,h=this.cmdTranslateAfter;var g=this.coordinateTransformation(j,true);if(m.useCssTansform){e.css(k,"none").css(f,l+g.x+"px, "+g.y+"px"+h)}else{e.css({left:g.x,top:g.y})}this.page=g.page;i.x=g.x;i.y=g.y;this.checkChangeEvents();return this},transitionEndHandler:function(g){var e=this,f=this.trannamespace;this.$handle.unbind(f).bind("webkitTransitionEnd"+f+" transitionend"+f+" oTransitionEnd"+f+" msTransitionEnd"+f+" transitionEnd"+f,function(){d(this).unbind(f).css(e.transition,"none");if(d.isFunction(g)){g.call(e)}});return this},cancelAnimation:function(){var e=this,j=this.$handle,i=this.current,h=this.base,f=this.options;if(this.isAminationRunning){this.isAminationRunning=false;if(this.options.useCssTansform){this.$handle.unbind(this.trannamespace).css(this.transition,"none");i.x=j.position().left-h.x;i.y=j.position().top-h.y}else{this.$handle.stop(true,false);i.x=e.toInt(j.css("left"));i.y=e.toInt(j.css("top"))}j.trigger("scrollEnd",e);var g=this.pageInfo(i.x,i.y);this.page=g.logical;this.checkChangeEvents();if(f.endless){if(g.physical<this.turnMin||g.physical>this.turnMax){this.silentGoto(this.page)}}}return this},checkChangeEvents:function(){var e=this.options;if(this.prevPage!=this.page){this.prevPage=this.page;if(d.isFunction(this.options.onPageChange)){var f={target:d(this.$originChild.eq(this.page-1)),page:this.page,count:this.lastPage};setTimeout(function(){e.onPageChange.call(f)},0)}}return this},scrollover:function(l,j,m){var n=this.options,g=this.current,h=this.pageSize,e=this.contentSizeExpanded;var k=0;var i=0;if(n.vertical){k=g.x;var f=g.y+j*n.ratio;if(f>0){f=0}else{if(f<e.y){f=e.y}}i=(j>0)?Math.ceil(f/h.y)*h.y:Math.floor(f/h.y)*h.y}else{tempX=g.x+l*n.ratio;if(tempX>0){tempX=0}else{if(tempX<e.x){tempX=e.x}}k=(l>0)?Math.ceil(tempX/h.x)*h.x:Math.floor(tempX/h.x)*h.x;i=g.y}this.moveTo(k,i,"flickEndless_easing","ease-out",m);return this},destroy:function(){this.disable();if(this.orignThisStyle===undefined){this.$this.removeAttr("style")}else{this.$this.attr("style",this.orignThisStyle)}if(this.orignHandlesStyle===undefined){this.$handle.removeAttr("style")}else{this.$handle.attr("style",this.orignHandlesStyle)}return this},option:function(g,h){var e=this;var f=g;if(arguments.length===0){return d.extend({},this.options)}if(typeof g==="string"){if(h===undefined){return this.options[g]}f={};f[g]=h}d.each(f,function(i,j){e.setOption(i,j)});return this},setOption:function(e,f){this.options[e]=f},toInt:function(e){if(e===undefined){return 0}var f=parseInt(String(e).replace("px",""),10);return(isFinite(f))?f:0}};c.prototype.create.prototype=c.prototype})(jQuery);